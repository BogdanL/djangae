
# New contains/icontains Query Backend

This release introduces a new method of gathering results from icontains and contains
queries. The previous implementation suffered the following drawbacks:

 - If a field was indexed for a contains-style query, the possible length of value of the field was limited.
   Saving a value which was too long would result in an error
 - The index data for such fields could become very large, this would make entities "heavy" and would result in
   performance issues across the site as this index data would be transferred with returned instance.
 - Index data was saved across several fields (due to a misunderstanding of the limits of list properties)

The new backend has none of these drawbacks. The limit for string value is the same as CharField (1500 bytes, 500 bytes for keys) and
index data is stored on a descendent entity meaning data isn't needlessly transferred with instances.

## Migrating

If you have been using contains/icontains fields on versions of Djangae before 0.9.10 you will need migrate your data. One potential
method for this is:

 1. Examine `djangaeidx.yaml` and make a note of the models which have contains or icontains indexes
 2. Deploy a version of your application to a non-default version (do not migrate traffic!). Make sure this
    version has `DJANGAE_USE_LEGACY_CONTAINS_LOGIC` set to `False` (default)
 3. Open a shell using the remote sandbox
 4. Import each model in turn and use the `defer_iteration` to resave your instance: e.g. `defer_iteration(MyModel.objects.all, MyModel.save)`
 5. Test the version works as expected before migrating traffic to it

Be aware that although this will add new index data, the original index data will still linger which will
affect performance. You can use Djangae's migration support to write a migration file to clear this data.
 
